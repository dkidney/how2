S4
================
2025-04-07

Create a new class along with a constructor function.

``` r
setClass("Person", 
  slots = c(
    name = "character", 
    age = "numeric"
  ), 
  prototype = list(
    name = NA_character_,
    age = NA_real_
  )
)

Person <- function(name, age = NA) {
  age <- as.double(age)
  new("Person", name = name, age = age)
}

setMethod("show", "Person", function(object) {
  cat(is(object)[[1]], "\n",
      "  Name: ", object@name, "\n",
      "  Age:  ", object@age, "\n",
      sep = ""
  )
})

setGeneric("name", function(x) standardGeneric("name"))
# [1] "name"
args(getGeneric("name"))
# function (x) 
# NULL
setMethod("name", "Person", function(x) x@name)

setGeneric("name<-", function(x, value) standardGeneric("name<-"))
# [1] "name<-"
setMethod("name<-", "Person", function(x, value) {
  x@name <- value
  validObject(x)
  x
})

setGeneric("age", function(x) standardGeneric("age"))
# [1] "age"
args(getGeneric("name"))
# function (x) 
# NULL
setMethod("age", "Person", function(x) x@age)

setGeneric("age<-", function(x, value) standardGeneric("age<-"))
# [1] "age<-"
setMethod("age<-", "Person", function(x, value) {
  x@age <- value
  validObject(x)
  x
})

setValidity("Person", function(object) {
 if (!grepl("^[A-Z]", object@name, perl = TRUE)) {
   "@name must start with a capital letter"
 } else if (!is.na(object@age) && object@age < 0) {
   "@age must be non-negative"
   TRUE
 } else {
 }
})
# Class "Person" [in ".GlobalEnv"]
# 
# Slots:
#                           
# Name:       name       age
# Class: character   numeric
# TODO
# selectMethod...
```

``` r
(bob = Person("Bob"))
# Person
#   Name: Bob
#   Age:  NA
isS4(bob)
# [1] TRUE
is(bob, 'Person')
# [1] TRUE
```

``` r
name(bob)
# [1] "Bob"
age(bob) = 42
age(bob)
# [1] 42
bob
# Person
#   Name: Bob
#   Age:  42
```

Create a new class using inheritance.

``` r
setClass("Employee", 
  contains = "Person", 
  slots = c(
    boss = "Person"
  ),
  prototype = list(
    boss = new("Person")
  )
)
```

``` r
sessionInfo()
# R version 4.4.2 (2024-10-31)
# Platform: x86_64-apple-darwin20
# Running under: macOS Monterey 12.7.6
# 
# Matrix products: default
# BLAS:   /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRblas.0.dylib 
# LAPACK: /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0
# 
# locale:
# [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
# 
# time zone: Europe/London
# tzcode source: internal
# 
# attached base packages:
# [1] stats     graphics  grDevices utils     datasets  methods   base     
# 
# loaded via a namespace (and not attached):
#  [1] compiler_4.4.2    fastmap_1.2.0     cli_3.6.4         tools_4.4.2      
#  [5] htmltools_0.5.8.1 rstudioapi_0.17.1 yaml_2.3.10       rmarkdown_2.29   
#  [9] knitr_1.50        xfun_0.52         digest_0.6.37     rlang_1.1.5      
# [13] evaluate_1.0.3
```
